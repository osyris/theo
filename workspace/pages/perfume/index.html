<!DOCTYPE html>
<html lang="ru">
<head>
<meta charset="UTF-8">
<meta name="viewport" content="width=device-width, initial-scale=1.0">
<title>–ü–∞—Ä—Ñ—é–º–µ—Ä–Ω–∞—è –∫–æ–ª–ª–µ–∫—Ü–∏—è –ù–∞—Ç–∞–ª–∏–∏</title>
<style>
  @import url('https://fonts.googleapis.com/css2?family=Bebas+Neue&family=Inter:wght@300;400;500&family=Playfair+Display:ital,wght@0,400;0,700;1,400&display=swap');

  :root {
    --bg: #ffffff; --card: #ffffff; --text: #1a1a1a; --muted: #888;
    --accent: #e63946; --accent-glow: #ff1a2e; --border: #e8e4e0;
    --tag-fruit: rgba(230,140,50,0.12); --tag-floral: rgba(200,80,120,0.12); --tag-gourmand: rgba(180,140,80,0.12);
    --tag-fresh: rgba(80,180,120,0.12); --tag-woody: rgba(160,130,100,0.12); --tag-oriental: rgba(140,80,160,0.12); --tag-musk: rgba(130,110,180,0.12);
  }
  * { margin:0; padding:0; box-sizing:border-box; }
  body { font-family:'Inter',sans-serif; background:var(--bg); color:var(--text); line-height:1.6; font-weight:300; }

  .hero { text-align:center; padding:4rem 1.5rem 2.5rem; background:#0a0a0a; }
  .hero h1 { font-family:'Bebas Neue',sans-serif; font-weight:400; font-size:3.5rem; letter-spacing:0.08em; margin-bottom:0.3rem; color:var(--accent); text-transform:uppercase; text-shadow:0 0 40px rgba(230,57,70,0.3); }
  .hero p { color:var(--muted); font-size:0.9rem; letter-spacing:0.15em; text-transform:uppercase; }

  .controls { max-width:960px; margin:0 auto; padding:1rem 1.5rem; display:flex; flex-wrap:wrap; gap:0.5rem; align-items:center; }
  .search-box { flex:1; min-width:200px; padding:0.6rem 1rem; border:1px solid var(--border); border-radius:2rem; font-size:0.85rem; font-family:inherit; background:#f8f6f4; color:var(--text); outline:none; }
  .search-box:focus { border-color:var(--accent); }
  .search-box::placeholder { color:#aaa; }
  .filter-btn { padding:0.6rem 1.4rem; border:1px solid #1a1a1a; border-radius:2rem; background:#0a0a0a; font-size:1rem; font-family:'Bebas Neue',sans-serif; cursor:pointer; transition:all 0.2s; color:#ccc; text-transform:uppercase; letter-spacing:0.12em; }
  .filter-btn:hover,.filter-btn.active { background:var(--accent); color:#fff; border-color:var(--accent); }
  .count { width:100%; text-align:right; font-size:0.78rem; color:var(--muted); padding-top:0.3rem; }

  .grid { max-width:960px; margin:0 auto; padding:0.5rem 1.5rem 3rem; display:grid; grid-template-columns:repeat(auto-fill,minmax(300px,1fr)); gap:1rem; }

  .card { background:var(--card); border:1px solid var(--border); border-radius:0.8rem; padding:1.2rem; transition:transform 0.2s,box-shadow 0.2s,border-color 0.2s; display:flex; gap:1rem; position:relative; cursor:pointer; }
  .card:hover { transform:translateY(-2px); box-shadow:0 6px 30px rgba(230,57,70,0.08); border-color:rgba(230,57,70,0.3); }

  .card-img { position:relative; width:75px; min-width:75px; height:95px; border-radius:0.8rem; overflow:hidden; flex-shrink:0; background:#f5f3f0; display:flex; align-items:center; justify-content:center; }
  .card-img img { width:100%; height:100%; object-fit:contain; }
  .card-img .initials { font-family:'Bebas Neue',sans-serif; font-size:1.4rem; color:#fff; width:100%; height:100%; display:flex; align-items:center; justify-content:center; text-shadow:0 0 10px rgba(230,57,70,0.5); }

  .card-body { flex:1; display:flex; flex-direction:column; gap:0.3rem; min-width:0; }
  .card-header { display:flex; justify-content:space-between; align-items:flex-start; gap:0.5rem; }
  .card-brand { font-size:0.68rem; text-transform:uppercase; letter-spacing:0.14em; color:var(--accent); font-weight:500; }
  .card-price { font-size:0.73rem; font-weight:500; color:var(--accent); background:rgba(230,57,70,0.06); padding:0.12rem 0.5rem; border-radius:1rem; white-space:nowrap; }
  .card-name { font-family:'Playfair Display',serif; font-size:1.1rem; font-weight:700; line-height:1.25; }
  .card-notes { font-size:0.74rem; color:var(--muted); font-style:italic; }
  .card-desc { font-size:0.77rem; color:#666; flex:1; }
  .card-tags { display:flex; flex-wrap:wrap; gap:0.25rem; margin-top:0.1rem; }
  .tag { font-size:0.63rem; padding:0.13rem 0.45rem; border-radius:0; text-transform:uppercase; letter-spacing:0.04em; }
  .tag-fruit { background:var(--tag-fruit); color:#e8a050; }
  .tag-floral { background:var(--tag-floral); color:#d06888; }
  .tag-gourmand { background:var(--tag-gourmand); color:#c8a060; }
  .tag-fresh { background:var(--tag-fresh); color:#50b878; }
  .tag-woody { background:var(--tag-woody); color:#b8a080; }
  .tag-oriental { background:var(--tag-oriental); color:#a870c0; }
  .tag-musk { background:var(--tag-musk); color:#8878b0; }
  .tag-male { background:rgba(80,120,180,0.15); color:#6090c0; }
  .card-source { font-size:0.65rem; color:#bbb; border-top:1px solid var(--border); padding-top:0.3rem; margin-top:auto; }
  .fav-ribbon { position:absolute; top:0; left:0; width:3.5rem; height:3.5rem; overflow:hidden; z-index:2; pointer-events:none; }
  .fav-ribbon::before { content:'‚òÜ'; position:absolute; top:0.3rem; left:0.3rem; font-size:0.75rem; color:#fff; z-index:3; line-height:1; }
  .fav-ribbon::after { content:''; position:absolute; top:-1rem; left:-1.5rem; width:4rem; height:2rem; background:var(--accent); transform:rotate(-45deg); }

  /* Modal ‚Äî Fragrantica style */
  .modal-overlay { display:none; position:fixed; top:0; left:0; width:100%; height:100%; background:rgba(0,0,0,0.45); z-index:100; backdrop-filter:blur(4px); justify-content:center; align-items:flex-start; padding:2rem 1rem; overflow-y:auto; }
  .modal-overlay.open { display:flex; }
  .modal { background:#fff; border-radius:1rem; max-width:680px; width:100%; padding:0; position:relative; box-shadow:0 20px 60px rgba(0,0,0,0.2); margin:auto; overflow:hidden; }
  .modal-close { position:absolute; top:0.8rem; right:0.8rem; background:rgba(255,255,255,0.9); border:none; font-size:1.3rem; cursor:pointer; color:#999; line-height:1; z-index:2; width:32px; height:32px; border-radius:50%; display:flex; align-items:center; justify-content:center; }
  .modal-close:hover { color:var(--accent); }

  /* Hero section ‚Äî Fragrantica-inspired layout */
  .m-hero { display:flex; gap:1.5rem; padding:2rem 2rem 1.5rem; background:#faf9f7; border-bottom:1px solid #e8e4e0; }
  .m-hero-left { display:flex; flex-direction:column; align-items:center; gap:0.6rem; }
  .m-photo { width:160px; min-width:160px; height:210px; background:#fff; border-radius:0.5rem; overflow:hidden; display:flex; align-items:center; justify-content:center; }
  .m-photo img { width:100%; height:100%; object-fit:contain; }
  .m-photo .initials { font-family:'Bebas Neue',sans-serif; font-size:2.5rem; color:#fff; width:100%; height:100%; display:flex; align-items:center; justify-content:center; background:linear-gradient(135deg,#3a1520,#1a0a10); }
  .m-rating-block { text-align:center; }
  .m-rating-stars { font-size:1.1rem; color:#e8a84a; }
  .m-rating-count { font-size:0.7rem; color:#999; }
  .m-hero-right { flex:1; display:flex; flex-direction:column; gap:0.8rem; }
  .m-title { }
  .m-brand { font-size:0.72rem; text-transform:uppercase; letter-spacing:0.12em; color:#999; font-weight:400; margin-bottom:0.15rem; }
  .m-name { font-family:'Playfair Display',serif; font-size:1.6rem; font-weight:700; line-height:1.2; margin-bottom:0.1rem; color:var(--text); }
  .m-subtitle { font-size:0.75rem; color:#999; }
  .m-meta-pills { display:flex; flex-wrap:wrap; gap:0.4rem; margin-bottom:0.3rem; }
  .m-pill { font-size:0.68rem; padding:0.18rem 0.55rem; border-radius:2rem; background:#f0ece8; color:#888; border:1px solid #e0dcd8; text-transform:uppercase; letter-spacing:0.04em; }
  .m-price-big { font-family:'Bebas Neue',sans-serif; font-size:1.6rem; color:var(--accent); }

  /* Hero right: accords inline */
  .m-hero-accords { flex:1; }
  .m-hero-accords .accord-bar { margin-bottom:0.25rem; }

  /* Profile box (longevity, sillage, daytime, seasons) */
  .m-profile-box { background:#faf9f7; border:1px solid #e8e4e0; border-radius:0.5rem; padding:0.7rem; }
  .m-profile-row { display:flex; gap:0.8rem; margin-bottom:0.5rem; justify-content:center; }
  .m-profile-item { display:flex; flex-direction:column; align-items:center; min-width:60px; }
  .m-profile-icon { font-size:1.1rem; }
  .m-profile-value { font-size:0.8rem; font-weight:500; color:var(--text); }
  .m-profile-label { font-size:0.6rem; text-transform:uppercase; letter-spacing:0.06em; color:#999; }
  .m-profile-seasons { display:flex; gap:0.3rem; flex-wrap:wrap; justify-content:center; }
  .m-profile-season { font-size:0.65rem; padding:0.15rem 0.45rem; border-radius:2rem; background:#eee; color:#999; }
  .m-profile-season.active { color:#fff; }
  .m-profile-season.day.active { background:#f0c850; color:#7a6020; }
  .m-profile-season.night.active { background:#5a6a8a; }
  .m-profile-season.winter.active { background:#7bafd4; }
  .m-profile-season.spring.active { background:#a0c87a; }
  .m-profile-season.summer.active { background:#e8c84a; }
  .m-profile-season.autumn.active { background:#d4956a; }

  /* Content area */
  .m-content { padding:1.5rem 2rem 2rem; background:#fff; }

  /* Accords ‚Äî Fragrantica bar style */
  .m-accords { margin-bottom:1rem; }
  .m-section-title { font-size:0.72rem; text-transform:uppercase; letter-spacing:0.14em; color:#999; font-weight:500; margin-bottom:0.5rem; }
  .accord-bar { display:flex; align-items:center; margin-bottom:0.25rem; gap:0.5rem; }
  .accord-fill { height:22px; border-radius:3px; min-width:30px; transition:width 0.4s ease; display:flex; align-items:center; padding-left:0.5rem; }
  .accord-label { font-size:0.73rem; color:#fff; white-space:nowrap; text-shadow:0 1px 2px rgba(0,0,0,0.3); }

  /* Stats row ‚Äî hidden, moved into profile box */
  .m-stats { display:none; }

  /* Seasons & daytime ‚Äî hidden, moved into profile box */
  .m-seasons { display:none; }

  /* Notes ‚Äî Fragrantica grid style */
  .m-pyramid { margin-bottom:1.5rem; }
  .pyramid-level { margin-bottom:1rem; }
  .pyramid-divider { display:flex; align-items:center; gap:1rem; margin-bottom:0.8rem; }
  .pyramid-divider::before, .pyramid-divider::after { content:''; flex:1; height:1px; background:#e0dcd8; }
  .pyramid-divider span { font-size:0.7rem; font-weight:500; text-transform:uppercase; letter-spacing:0.12em; color:#999; white-space:nowrap; }
  .note-bubbles { display:flex; flex-wrap:wrap; gap:0.5rem; justify-content:flex-start; }
  .note-bubble { display:flex; flex-direction:column; align-items:center; gap:0.3rem; width:72px; }
  .note-circle { width:56px; height:56px; border-radius:50%; display:flex; align-items:center; justify-content:center; font-size:1.5rem; background:#f5f3f0; border:2px solid #e8e4e0; transition:transform 0.2s, border-color 0.2s; cursor:default; }
  .note-circle:hover { transform:scale(1.08); border-color:var(--accent); }
  .note-name { font-size:0.65rem; color:#666; text-align:center; line-height:1.2; max-width:72px; overflow:hidden; text-overflow:ellipsis; }

  /* Description */
  .m-desc { margin-bottom:1.5rem; }
  .m-desc-text { font-size:0.88rem; color:#555; line-height:1.7; }

  /* Details grid */
  .m-details { display:grid; grid-template-columns:1fr 1fr; gap:0.6rem 1.5rem; margin-bottom:1.5rem; }
  .m-detail { display:flex; flex-direction:column; }
  .m-detail-label { font-size:0.65rem; text-transform:uppercase; letter-spacing:0.08em; color:#555; margin-bottom:0.1rem; }
  .m-detail-value { font-size:0.85rem; color:var(--text); }

  .m-tags { display:flex; flex-wrap:wrap; gap:0.3rem; margin-bottom:1.2rem; }
  .m-source { font-size:0.72rem; color:#bbb; border-top:1px solid #e8e4e0; padding-top:0.8rem; }

  @media(max-width:600px) {
    .hero h1 { font-size:2.5rem; }
    .grid { grid-template-columns:1fr; }
    .card-img { width:60px; min-width:60px; height:78px; }
    .m-hero { flex-direction:column; align-items:center; text-align:center; padding:1.5rem; }
    .m-photo { width:130px; min-width:130px; height:170px; }
    .m-meta-pills { justify-content:center; }
    .m-content { padding:1.2rem 1.5rem 1.5rem; }
    .m-details { grid-template-columns:1fr; }
    .note-bubble { width:60px; }
    .note-circle { width:44px; height:44px; font-size:1.1rem; }
  }
</style>
</head>
<body>

<div class="hero">
  <h1>PERFUME COLLECTION</h1>
  <p>No filters. No rules. Only scents that matter.</p>
</div>

<div class="controls">
  <input type="text" class="search-box" placeholder="–ü–æ–∏—Å–∫ –ø–æ –±—Ä–µ–Ω–¥—É, –Ω–∞–∑–≤–∞–Ω–∏—é, –Ω–æ—Ç–∞–º..." id="search">
  <button class="filter-btn active" data-filter="all">All</button>
  <button class="filter-btn" data-filter="fruit">Fruity</button>
  <button class="filter-btn" data-filter="floral">Floral</button>
  <button class="filter-btn" data-filter="gourmand">Gourmand</button>
  <button class="filter-btn" data-filter="fresh">Fresh</button>
  <button class="filter-btn" data-filter="woody">Woody</button>
  <button class="filter-btn" data-filter="oriental">Oriental</button>
  <button class="filter-btn" data-filter="male">For Him</button>
  <div class="count" id="count"></div>
</div>

<div class="grid" id="grid"></div>

<div class="modal-overlay" id="modalOverlay">
  <div class="modal" id="modal"></div>
</div>

<script>
const gradients = [
  'linear-gradient(135deg,#3a1520,#1a0a10)','linear-gradient(135deg,#152030,#0a1520)',
  'linear-gradient(135deg,#2a1530,#150a20)','linear-gradient(135deg,#302818,#1a150a)',
  'linear-gradient(135deg,#153020,#0a1a10)','linear-gradient(135deg,#301520,#1a0a15)',
];

let perfumes = [];

fetch('perfumes.json')
  .then(r => { if (!r.ok) throw new Error(r.status); return r.json(); })
  .then(data => { perfumes = data; initApp(); })
  .catch(err => {
    console.error('Failed to load perfumes:', err);
    document.getElementById('grid').innerHTML = '<p style="text-align:center;padding:2rem;color:#e63946;">–ù–µ —É–¥–∞–ª–æ—Å—å –∑–∞–≥—Ä—É–∑–∏—Ç—å –¥–∞–Ω–Ω—ã–µ. –ü–æ–ø—Ä–æ–±—É–π—Ç–µ –æ–±–Ω–æ–≤–∏—Ç—å —Å—Ç—Ä–∞–Ω–∏—Ü—É.</p>';
  });

function initApp() {

const grid = document.getElementById('grid');
const search = document.getElementById('search');
const countEl = document.getElementById('count');
const modalOverlay = document.getElementById('modalOverlay');
const modal = document.getElementById('modal');
let activeFilter = 'all';

function getInitials(b) { return b.split(/[\s&]+/).map(w=>w[0]).filter(Boolean).slice(0,2).join('').toUpperCase(); }
function hashCode(s) { let h=0; for(let i=0;i<s.length;i++) h=((h<<5)-h+s.charCodeAt(i))|0; return Math.abs(h); }

const tagLabels = {fruit:'—Ñ—Ä—É–∫—Ç–æ–≤—ã–π',floral:'—Ü–≤–µ—Ç–æ—á–Ω—ã–π',gourmand:'–≥—É—Ä–º–∞–Ω—Å–∫–∏–π',fresh:'—Å–≤–µ–∂–∏–π',woody:'–¥—Ä–µ–≤–µ—Å–Ω—ã–π',oriental:'–≤–æ—Å—Ç–æ—á–Ω—ã–π',musk:'–º—É—Å–∫—É—Å–Ω—ã–π',male:'–º—É–∂—Å–∫–æ–π'};

function imgHTML(p, cls) {
  const grad = gradients[hashCode(p.brand+p.name) % gradients.length];
  const ini = getInitials(p.brand);
  if (p.img) return `<img src="${p.img}" alt="${p.name}" loading="lazy" onerror="this.parentElement.innerHTML='<div class=\\'initials\\' style=\\'background:${grad}\\'>${ini}</div>'">`;
  return `<div class="initials" style="background:${grad}">${ini}</div>`;
}

// Note emoji mapping
const noteEmojis = {
  '–º–∞–Ω–≥–æ':'ü•≠','–∫–æ–∫–æ—Å':'ü••','–∫–æ–∫–æ—Å–æ–≤–æ–µ –º–æ–ª–æ–∫–æ':'ü••','–ø–µ—Ä—Å–∏–∫':'üçë','–≥—Ä—É—à–∞':'üçê','–ª–∏–º–æ–Ω':'üçã',
  '–±–µ—Ä–≥–∞–º–æ—Ç':'üçä','–º–∞–Ω–¥–∞—Ä–∏–Ω':'üçä','–∞–ø–µ–ª—å—Å–∏–Ω':'üçä','–≥—Ä–µ–π–ø—Ñ—Ä—É—Ç':'üçä','—Ä–æ–∑–æ–≤—ã–π –≥—Ä–µ–π–ø—Ñ—Ä—É—Ç':'üçä',
  '–ª–∏—á–∏':'ü´ê','–º–∞–ª–∏–Ω–∞':'ü´ê','—á—ë—Ä–Ω–∞—è —Å–º–æ—Ä–æ–¥–∏–Ω–∞':'ü´ê','–º–∞—Ä–∞–∫—É–π—è':'ü´ê','–∞–Ω–∞–Ω–∞—Å':'üçç','–∞—Ä–±—É–∑':'üçâ',
  '—Ä–æ–∑–∞':'üåπ','–º–∞–π—Å–∫–∞—è —Ä–æ–∑–∞':'üåπ','–±–µ–ª–∞—è —Ä–æ–∑–∞':'üåπ','–ø–∏–æ–Ω':'üå∏','–ª–∞–Ω–¥—ã—à':'üå∑','–∂–∞—Å–º–∏–Ω':'üåº',
  '–∂–∞—Å–º–∏–Ω —Å–∞–º–±–∞–∫':'üåº','—Ç—É–±–µ—Ä–æ–∑–∞':'üå∫','–º–∞–≥–Ω–æ–ª–∏—è':'üå∫','–∏—Ä–∏—Å':'üíú','–Ω–µ—Ä–æ–ª–∏':'üåº','—Ñ—Ä–µ–∑–∏—è':'üå∏',
  '–≥–∏–±–∏—Å–∫—É—Å':'üå∫','–æ—Ä—Ö–∏–¥–µ—è':'üå∫','—Ç–∏–∞—Ä–µ':'üåº','—Ç–∏–∞—Ä–µ (—Ç–∞–∏—Ç—è–Ω—Å–∫–∞—è –≥–∞—Ä–¥–µ–Ω–∏—è)':'üåº','–∏–ª–∞–Ω–≥-–∏–ª–∞–Ω–≥':'üåº',
  '–≥–µ—Ä–∞–Ω—å':'üåø','—Ñ–∏–∞–ª–∫–∞':'üíú','–≥–µ–ª–∏–æ—Ç—Ä–æ–ø':'üå∏','–¥–∞–≤–∞–Ω–∞':'üåø','—Ü–≤–µ—Ç–æ–∫ –∞–ø–µ–ª—å—Å–∏–Ω–∞':'üåº',
  '–≤–∞–Ω–∏–ª—å':'üç¶','–±—É—Ä–±–æ–Ω—Å–∫–∞—è –≤–∞–Ω–∏–ª—å':'üç¶','–∫–∞—Ä–∞–º–µ–ª—å':'üç¨','—à–æ–∫–æ–ª–∞–¥':'üç´','—Ç—ë–º–Ω—ã–π —à–æ–∫–æ–ª–∞–¥':'üç´',
  '–±–µ–ª—ã–π —à–æ–∫–æ–ª–∞–¥':'üç´','–∫–æ—Ñ–µ':'‚òï','–º–æ–ª–æ–∫–æ':'ü•õ','—Ä–∏—Å':'üçö','—Ä–∏—Å–æ–≤—ã–π –ø—É–¥–∏–Ω–≥':'üçö',
  '–º–∞—Ä—à–º–µ–ª–ª–æ—É':'‚òÅÔ∏è','–º—ë–¥':'üçØ','–∫–æ—Ä–∏—Ü–∞':'ü´ö','–∫–∞—Ä–¥–∞–º–æ–Ω':'ü´ö','–∏–º–±–∏—Ä—å':'ü´ö',
  '—Ä–æ–º':'ü•É','–∞–º–∞—Ä–µ—Ç—Ç–æ':'ü•É','–∫–æ–≥–Ω–∞–∫':'ü•É','tutti-frutti':'üç¨',
  '—Å–∞–Ω–¥–∞–ª':'ü™µ','–∫–µ–¥—Ä':'üå≤','–≤–µ—Ç–∏–≤–µ—Ä':'üåø','–ø–∞—á—É–ª–∏':'üçÇ','–º—É—Å–∫—É—Å':'üí®','–±–µ–ª—ã–π –º—É—Å–∫—É—Å':'üí®',
  '–∫–∞—à–µ–º–∏—Ä–æ–≤—ã–π –º—É—Å–∫—É—Å':'üí®','–∞–º–±—Ä–∞':'‚ú®','–±–µ–ª–∞—è –∞–º–±—Ä–∞':'‚ú®','—Å–µ—Ä–∞—è –∞–º–±—Ä–∞':'‚ú®',
  '–±–æ–±—ã —Ç–æ–Ω–∫–∞':'ü´ò','–ª–∞–±–¥–∞–Ω—É–º':'ü™µ','–±–µ–Ω–∑–æ–∏–Ω':'ü™µ','–∫–∞—à–º–µ—Ä–∞–Ω':'ü™µ','–º–æ—Ö':'üåø',
  '–ª–∞–¥–∞–Ω':'üí´','–º–∏—Ä—Ä–∞':'üí´','—ç–ª–µ–º–∏':'üí´','—Å—Ç–∏—Ä–∞–∫—Å':'ü™µ','–≥–∞–ª—å–±–∞–Ω—É–º':'üåø',
  '—Ä–æ–∑–æ–≤—ã–π –ø–µ—Ä–µ—Ü':'üå∂Ô∏è','—á—ë—Ä–Ω—ã–π –ø–µ—Ä–µ—Ü':'üå∂Ô∏è','—Å—ã—á—É–∞–Ω—å—Å–∫–∏–π –ø–µ—Ä–µ—Ü':'üå∂Ô∏è','–ø–µ—Ä–µ—Ü':'üå∂Ô∏è',
  '—à–∞—Ñ—Ä–∞–Ω':'üß°','–º—É—Å–∫–∞—Ç–Ω—ã–π –æ—Ä–µ—Ö':'ü´ö','—Ç–∞–±–∞–∫':'üçÇ','–∫–æ–∂–∞':'üëú','–∑–∞–º—à–∞':'üëú',
  '—Ä–µ–≤–µ–Ω—å':'üåø','—Ñ–∏–≥–æ–≤—ã–µ –ª–∏—Å—Ç—å—è':'üåø','–∏–Ω–∂–∏—Ä':'ü´í','—á–∞–π –º–∞—Ç—á–∞':'üçµ','–∑–µ–ª—ë–Ω—ã–π —á–∞–π':'üçµ',
  '–ª–∞–≤–∞–Ω–¥–∞':'üíú','–º—è—Ç–∞':'üåø','—à–∞–ª—Ñ–µ–π':'üåø','–º–æ–∂–∂–µ–≤–µ–ª—å–Ω–∏–∫':'üå≤',
  '–∞–º–±—Ä–æ–∫—Å–∞–Ω':'üíé','iso e super':'üíé','–º–æ—Ä—Å–∫–∞—è —Å–æ–ª—å':'üåä','–≤–æ–¥–Ω—ã–µ –Ω–æ—Ç—ã':'üåä',
  '–∞–ª—å–¥–µ–≥–∏–¥—ã':'üí´','–≤–∞—Ñ–µ–ª—å–Ω—ã–π —Ä–æ–∂–æ–∫':'üßá','–æ—Å–º–∞–Ω—Ç—É—Å':'üåº','–¥—É–±':'üå≥',
  '–¥—Ä–µ–≤–µ—Å–Ω—ã–µ –Ω–æ—Ç—ã':'ü™µ','—Å—É—Ö–æ–µ –¥–µ—Ä–µ–≤–æ':'ü™µ','–±–ª–æ–Ω–¥–∏–Ω—Å–∫–∞—è –¥—Ä–µ–≤–µ—Å–∏–Ω–∞':'ü™µ',
  '–∫–æ–∫–æ—Å–æ–≤–æ–µ –º–æ–ª–æ–∫–æ':'ü••','–∫—Ä–∞—Å–Ω—ã–µ –≤–æ–¥–æ—Ä–æ—Å–ª–∏':'üåä','–∞–º–±—Ä–µ—Ç—Ç–∞':'üåø','—Å–∞–ø—Ñ–∏—Ä–æ–≤–∞—è —è–≥–æ–¥–∞':'ü´ê',
  '–º–∏–Ω–µ—Ä–∞–ª—å–Ω—ã–π –∞–∫–∫–æ—Ä–¥':'üíé','–∑–µ–ª—ë–Ω—ã–µ –Ω–æ—Ç—ã':'üåø','—Ü–≤–µ—Ç–æ—á–Ω—ã–µ –Ω–æ—Ç—ã':'üå∏',
  '—Ç–∏–∞—Ä–µ':'üåº','–±–∞–ª—å–∑–∞–º–∏—á–µ—Å–∫–∏–µ –Ω–æ—Ç—ã':'üí´','–∫–∞–ª–∞–±—Ä–∏–π—Å–∫–∏–π –±–µ—Ä–≥–∞–º–æ—Ç':'üçä',
  '—Å–∏—Ü–∏–ª–∏–π—Å–∫–∏–π –≥–æ—Ä—å–∫–∏–π –∞–ø–µ–ª—å—Å–∏–Ω':'üçä','–∫—Ä–æ–≤–∞–≤–æ-–∫—Ä–∞—Å–Ω—ã–π –∞–ø–µ–ª—å—Å–∏–Ω':'üçä',
  '—á—ë—Ä–Ω–∞—è –≤–∏—à–Ω—è':'üçí','—è–≥–æ–¥—ã':'ü´ê',
  '–æ–≥—É—Ä–µ—Ü':'ü•í','–ª–∞–π–º':'üçã‚Äçüü©','—è–≥–æ–¥—ã –º–æ–∂–∂–µ–≤–µ–ª—å–Ω–∏–∫–∞':'ü´ê','–ª–∏—Å—Ç —Ñ–∏–∞–ª–∫–∏':'üåø',
  '–æ–∑–æ–Ω–æ–≤—ã–µ –Ω–æ—Ç—ã':'üí®','–ª–∞–∫—Ç–æ–Ω—ã':'üß™','–∞–º–±—Ä–æ–∫—Å–∞–Ω':'üíé',
  '—Ä–∏—Å':'üçö','—Ç—É–±–µ—Ä–æ–∑–∞':'üå∫','–≥–≤–æ–∑–¥–∏–∫–∞':'üåø',
};

function getNoteEmoji(note) {
  const n = note.toLowerCase().trim();
  return noteEmojis[n] || 'üîò';
}

// Accord colors (Fragrantica style)
const accordColors = {
  '—Ñ—Ä—É–∫—Ç–æ–≤—ã–π':'#e8a87c','—Ü–≤–µ—Ç–æ—á–Ω—ã–π':'#d4708a','–≥—É—Ä–º–∞–Ω—Å–∫–∏–π':'#c49b66',
  '—Å–≤–µ–∂–∏–π':'#7ec8a0','–¥—Ä–µ–≤–µ—Å–Ω—ã–π':'#a0856e','–≤–æ—Å—Ç–æ—á–Ω—ã–π':'#9a7bb5',
  '–º—É—Å–∫—É—Å–Ω—ã–π':'#b0a0c0','—Ü–∏—Ç—Ä—É—Å–æ–≤—ã–π':'#e8c84a','–ø—Ä—è–Ω—ã–π':'#c87040',
  '–∫–æ–∂–∞–Ω—ã–π':'#8a6a50','–∑–µ–ª—ë–Ω—ã–π':'#6aaa6a','–º–æ—Ä—Å–∫–æ–π':'#5a9aba',
  '–º–æ–ª–µ–∫—É–ª—è—Ä–Ω—ã–π':'#a0b0c0','—á–∏—Å—Ç—ã–π, –∞–ª—å–¥–µ–≥–∏–¥–Ω—ã–π':'#c0c8d0',
};

window.openModal = function(idx) {
  const p = perfumes[idx];
  const grad = gradients[hashCode(p.brand+p.name) % gradients.length];
  const tagHTML = p.tags.map(t=>`<span class="tag tag-${t}">${tagLabels[t]||t}</span>`).join('');

  // Pills
  let pills = [];
  if (p.year) pills.push(`<span class="m-pill">üìÖ ${p.year}</span>`);
  if (p.concentration) pills.push(`<span class="m-pill">üíß ${p.concentration}</span>`);
  if (p.gender) pills.push(`<span class="m-pill">${p.gender==='–ú'?'‚ôÇÔ∏è':'‚ôÄÔ∏è'} ${p.gender}</span>`);

  // Notes pyramid (Fragrantica-style bubbles)
  let pyramidHTML = '';
  if (p.pyramid) {
    const levels = [
      {key:'top', label:'top notes'},
      {key:'mid', label:'heart notes'},
      {key:'base', label:'base notes'},
    ];
    let levelsHTML = '';
    for (const lv of levels) {
      const raw = p.pyramid[lv.key];
      if (!raw || raw === '‚Äî') continue;
      const notes = raw.split(',').map(n=>n.trim()).filter(Boolean);
      const bubblesHTML = notes.map(n => `
        <div class="note-bubble">
          <div class="note-circle">${getNoteEmoji(n)}</div>
          <span class="note-name">${n}</span>
        </div>`).join('');
      levelsHTML += `
        <div class="pyramid-level">
          <div class="pyramid-divider"><span>${lv.label}</span></div>
          <div class="note-bubbles">${bubblesHTML}</div>
        </div>`;
    }
    if (levelsHTML) pyramidHTML = `<div class="m-pyramid"><div class="m-section-title">notes</div>${levelsHTML}</div>`;
  }

  // Main accords
  let accordsHTML = '';
  if (p.accords && p.accords.length) {
    const bars = p.accords.map(a =>
      `<div class="accord-bar"><div class="accord-fill" style="width:${a.w}%;background:${a.color}"><span class="accord-label">${a.name}</span></div></div>`
    );
    accordsHTML = `<div class="m-accords"><div class="m-section-title">main accords</div>${bars.join('')}</div>`;
  } else if (p.family) {
    const families = p.family.split(/[-,]/).map(f=>f.trim().toLowerCase());
    const bars = families.map((f,i) => {
      const w = Math.max(40, 100 - i*25);
      const color = accordColors[f] || '#b0a090';
      const label = f.charAt(0).toUpperCase() + f.slice(1);
      return `<div class="accord-bar"><div class="accord-fill" style="width:${w}%;background:${color}"><span class="accord-label">${label}</span></div></div>`;
    });
    accordsHTML = `<div class="m-accords"><div class="m-section-title">main accords</div>${bars.join('')}</div>`;
  }

  // Stats
  let statsHTML = '';
  {
    let stats = [];
    if (p.rating) stats.push(`<div class="m-stat"><span class="m-stat-value">‚≠ê ${p.rating}</span><span class="m-stat-label">–†–µ–π—Ç–∏–Ω–≥${p.votes?' ('+p.votes+')':''}</span></div>`);
    if (p.longevity) stats.push(`<div class="m-stat"><span class="m-stat-value">‚è±Ô∏è ${p.longevity}</span><span class="m-stat-label">–°—Ç–æ–π–∫–æ—Å—Ç—å</span></div>`);
    if (p.sillage) stats.push(`<div class="m-stat"><span class="m-stat-value">üí® ${p.sillage}</span><span class="m-stat-label">–®–ª–µ–π—Ñ</span></div>`);
    if (stats.length) statsHTML = `<div class="m-stats">${stats.join('')}</div>`;
  }

  // Seasons & daytime
  let seasonsHTML = '';
  {
    const allSeasons = [
      {key:'day',label:'‚òÄÔ∏è –î–µ–Ω—å',cls:'day'},{key:'night',label:'üåô –ù–æ—á—å',cls:'night'},
      {key:'winter',label:'‚ùÑÔ∏è –ó–∏–º–∞',cls:'winter'},{key:'spring',label:'üå∏ –í–µ—Å–Ω–∞',cls:'spring'},
      {key:'summer',label:'‚òÄÔ∏è –õ–µ—Ç–æ',cls:'summer'},{key:'autumn',label:'üçÇ –û—Å–µ–Ω—å',cls:'autumn'},
    ];
    const dt = p.daytime || [];
    const ss = p.seasons || [];
    const all = [...dt, ...ss];
    if (all.length) {
      const pills = allSeasons.map(s =>
        `<span class="m-season ${s.cls} ${all.includes(s.key)?'active':''}">${s.label}</span>`
      );
      seasonsHTML = `<div class="m-seasons">${pills.join('')}</div>`;
    }
  }

  // Details grid
  let details = '';
  let dItems = [];
  if (p.perfumer) dItems.push(['–ü–∞—Ä—Ñ—é–º–µ—Ä', p.perfumer]);
  if (p.family) dItems.push(['–°–µ–º–µ–π—Å—Ç–≤–æ', p.family]);
  if (p.concentration) dItems.push(['–ö–æ–Ω—Ü–µ–Ω—Ç—Ä–∞—Ü–∏—è', p.concentration]);
  if (p.gender) dItems.push(['–ü–æ–ª', p.gender === '–ú' ? '–ú—É–∂—Å–∫–æ–π' : p.gender === '–ñ' ? '–ñ–µ–Ω—Å–∫–∏–π' : '–£–Ω–∏—Å–µ–∫—Å']);
  if (dItems.length) {
    details = `<div class="m-details">${dItems.map(d=>`<div class="m-detail"><span class="m-detail-label">${d[0]}</span><span class="m-detail-value">${d[1]}</span></div>`).join('')}</div>`;
  }

  // Build profile box (longevity, sillage, daytime, seasons) ‚Äî Fragrantica style
  let profileHTML = '';
  {
    let hasProfile = p.longevity || p.sillage || (p.daytime && p.daytime.length) || (p.seasons && p.seasons.length);
    if (hasProfile) {
      let profileRows = '';
      if (p.longevity || p.sillage) {
        let items = '';
        if (p.longevity) items += `<div class="m-profile-item"><div class="m-profile-icon">‚è±</div><div class="m-profile-value">${p.longevity}</div><div class="m-profile-label">–°—Ç–æ–π–∫–æ—Å—Ç—å</div></div>`;
        if (p.sillage) items += `<div class="m-profile-item"><div class="m-profile-icon">„Ä∞Ô∏è</div><div class="m-profile-value">${p.sillage}</div><div class="m-profile-label">–®–ª–µ–π—Ñ</div></div>`;
        profileRows += `<div class="m-profile-row">${items}</div>`;
      }
      const allDT = [{key:'day',label:'‚òÄÔ∏è –î–µ–Ω—å',cls:'day'},{key:'night',label:'üåô –ù–æ—á—å',cls:'night'}];
      const allSS = [{key:'winter',label:'‚ùÑÔ∏è –ó–∏–º–∞',cls:'winter'},{key:'spring',label:'üå∏ –í–µ—Å–Ω–∞',cls:'spring'},{key:'summer',label:'‚òÄÔ∏è –õ–µ—Ç–æ',cls:'summer'},{key:'autumn',label:'üçÇ –û—Å–µ–Ω—å',cls:'autumn'}];
      const dt = p.daytime || []; const ss = p.seasons || [];
      if (dt.length) {
        const dtPills = allDT.map(s=>`<span class="m-profile-season ${s.cls} ${dt.includes(s.key)?'active':''}">${s.label}</span>`).join('');
        profileRows += `<div class="m-profile-row"><div class="m-profile-item"><div class="m-profile-label" style="margin-bottom:0.3rem">–í—Ä–µ–º—è —Å—É—Ç–æ–∫</div><div class="m-profile-seasons">${dtPills}</div></div></div>`;
      }
      if (ss.length) {
        const ssPills = allSS.map(s=>`<span class="m-profile-season ${s.cls} ${ss.includes(s.key)?'active':''}">${s.label}</span>`).join('');
        profileRows += `<div class="m-profile-row"><div class="m-profile-item"><div class="m-profile-label" style="margin-bottom:0.3rem">–°–µ–∑–æ–Ω—ã</div><div class="m-profile-seasons">${ssPills}</div></div></div>`;
      }
      profileHTML = `<div class="m-profile-box">${profileRows}</div>`;
    }
  }

  // Rating HTML
  let ratingHTML = '';
  if (p.rating) {
    const stars = '‚òÖ'.repeat(Math.round(p.rating)) + '‚òÜ'.repeat(5 - Math.round(p.rating));
    ratingHTML = `<div class="m-rating-block"><div class="m-rating-stars">${p.rating} ${stars}</div>${p.votes?`<div class="m-rating-count">(${p.votes})</div>`:''}</div>`;
  }

  modal.innerHTML = `
    <button class="modal-close" onclick="closeModal()">&times;</button>
    <div class="m-hero">
      <div class="m-hero-left">
        <div class="m-photo">${imgHTML(p)}</div>
        ${ratingHTML}
      </div>
      <div class="m-hero-right">
        <div class="m-title">
          <div class="m-name">${p.name}</div>
          <div class="m-subtitle">By ${p.brand} ‚Ä¢ ${p.gender||'unisex'}</div>
          <div class="m-meta-pills">${pills.join('')}</div>
        </div>
        ${accordsHTML ? `<div class="m-hero-accords">${accordsHTML}</div>` : ''}
        ${profileHTML}
      </div>
    </div>
    <div class="m-content">
      ${pyramidHTML}
      ${p.desc&&p.desc!=='‚Äî'?`<div class="m-desc"><div class="m-section-title">–û–ø–∏—Å–∞–Ω–∏–µ</div><div class="m-desc-text">${p.desc}</div></div>`:''}
      ${details}
      ${p.price?`<div style="margin-bottom:1rem"><span style="font-family:Bebas Neue;font-size:1.4rem;color:var(--accent)">${p.price}</span></div>`:''}
      <div class="m-tags">${tagHTML}</div>
      <div class="m-source">–ò—Å—Ç–æ—á–Ω–∏–∫: ${p.source}</div>
    </div>
  `;
  modalOverlay.classList.add('open');
  document.body.style.overflow = 'hidden';
}

window.closeModal = function() {
  modalOverlay.classList.remove('open');
  document.body.style.overflow = '';
}
modalOverlay.addEventListener('click', e => { if (e.target === modalOverlay) closeModal(); });
document.addEventListener('keydown', e => { if (e.key === 'Escape') closeModal(); });

function render() {
  const q = search.value.toLowerCase();
  const filtered = perfumes.map((p,i)=>({...p,idx:i})).filter(p => {
    const matchFilter = activeFilter==='all' || p.tags.includes(activeFilter);
    const matchSearch = !q || [p.brand,p.name,p.notes,p.desc,p.price||'',p.family||''].join(' ').toLowerCase().includes(q);
    return matchFilter && matchSearch;
  });
  countEl.textContent = `${filtered.length} –∏–∑ ${perfumes.length} –∞—Ä–æ–º–∞—Ç–æ–≤`;

  grid.innerHTML = filtered.map(p => {
    const tagHTML = p.tags.map(t=>`<span class="tag tag-${t}">${tagLabels[t]||t}</span>`).join('');
    const priceHTML = p.price ? `<span class="card-price">${p.price}</span>` : '';
    const favHTML = p.fav ? '<div class="fav-ribbon"></div>' : '';

    return `
      <div class="card" onclick="openModal(${p.idx})">
        <div class="card-img">${favHTML}${imgHTML(p)}</div>
        <div class="card-body">
          <div class="card-header">
            <div class="card-brand">${p.brand}</div>
            ${priceHTML}
          </div>
          <div class="card-name">${p.name}</div>
          ${p.notes&&p.notes!=='‚Äî'?`<div class="card-notes">${p.notes}</div>`:''}
          ${p.desc&&p.desc!=='‚Äî'?`<div class="card-desc">${p.desc}</div>`:''}
          <div class="card-tags">${tagHTML}</div>
          <div class="card-source">via ${p.source}</div>
        </div>
      </div>`;
  }).join('');
}

document.querySelectorAll('.filter-btn').forEach(btn => {
  btn.addEventListener('click', () => {
    document.querySelectorAll('.filter-btn').forEach(b=>b.classList.remove('active'));
    btn.classList.add('active');
    activeFilter = btn.dataset.filter;
    render();
  });
});

search.addEventListener('input', render);
render();
}
</script>
</body>
</html>
